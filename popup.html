<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Plan My Day â€” Todoist</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="wrap">
      <!-- Screen 0: Token prompt (only shown if no token saved) -->
      <section id="screen-token" class="screen hidden">
        <h1>Connect Todoist</h1>
        <p>Paste your Todoist <strong>API token</strong> (Settings â†’ Integrations â†’ API token).</p>
        <input id="tokenInput" type="password" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" />
        <div class="row">
          <button id="saveToken">Save token</button>
        </div>
        <p class="hint">Your token is stored locally in <code>chrome.storage.sync</code>.</p>
      </section>

      <!-- Screen 1: Start -->
      <section id="screen-start" class="screen">
        <h1 class="header-title"><img src="assets/icon-128.png" alt="" width="20" height="20" /> Plan my day for Todoist tasks</h1>

        <div class="feature">
          <div class="feature-head">
            <div class="feature-title">Plan my day</div>
            <div class="feature-subtitle">Review overdue and today's tasks</div>
          </div>
          <div class="feature-body">
            <button id="planBtn">Start planning</button>
          </div>
        </div>

        <div class="feature">
          <div class="feature-head">
            <div class="feature-title">Search tasks</div>
            <div class="feature-subtitle">Find up to 50 active tasks by keyword</div>
          </div>
          <div class="feature-body">
            <div class="row">
              <input id="searchInput" type="text" placeholder="Type keyword..." />
              <button id="searchBtn" class="secondary">Search</button>
            </div>
          </div>
        </div>

        <div class="feature">
          <div class="feature-head">
            <div class="feature-title">Top 5 for today</div>
            <div class="feature-subtitle">Soonest tasks with due time today</div>
          </div>
          <div class="feature-body">
            <div id="top5List" class="list"></div>
          </div>
        </div>
      </section>

      <!-- Screen 2: Task review -->
      <section id="screen-task" class="screen hidden">
        <div class="task-card">
          <div class="task-title" id="taskTitle"></div>
          <div class="task-meta" id="taskMeta"></div>
        </div>

        <!-- Voice key prompt (hidden; shown only when starting voice without a saved key) -->
        <div class="row" id="voiceRow" style="display:none; justify-content:space-between; gap:8px; align-items:center; margin:6px 0 10px;">
          <div class="row" style="gap:8px; margin:0; align-items:center;">
            <input id="openaiKeyInput" type="password" placeholder="OpenAI API key for voice (Cove)" style="width:260px;" />
            <button id="saveOpenAIKey" class="secondary sm" title="Save OpenAI key">Save</button>
          </div>
        </div>

        <!-- Date selection group (preset radios + custom calendar) -->
        <div class="group">
          <div class="label">Date</div>
          <div class="radios">
            <label><input type="radio" name="dateChoice" value="today" checked /> Today</label>
            <label><input type="radio" name="dateChoice" value="tomorrow" /> Tomorrow</label>
            <label><input type="radio" name="dateChoice" value="next_mon" /> next Mon</label>
            <label><input type="radio" name="dateChoice" value="next_tue" /> next Tues</label>
            <label><input type="radio" name="dateChoice" value="next_wed" /> next Wed</label>
            <label><input type="radio" name="dateChoice" value="next_thu" /> next Thurs</label>
            <label><input type="radio" name="dateChoice" value="next_fri" /> next Fri</label>
            <label><input type="radio" name="dateChoice" value="next_sat" /> next Sat</label>
            <label><input type="radio" name="dateChoice" value="next_sun" /> next Sun</label>
            <label><input type="radio" name="dateChoice" value="next_28th" /> next 28th</label>
            <label><input type="radio" name="dateChoice" value="next_1st" /> next 1st</label>
            <label><input type="radio" name="dateChoice" value="skip_next" /> Skip to next occurrence</label>
          </div>
        </div>

        <!-- Labels grouped by meaning -->
        <div class="group">
          <div class="label">Urgency</div>
          <div class="checks">
            <label><input type="radio" name="urgencyChoice" value="urgent-now" /> urgent-now</label>
            <label><input type="radio" name="urgencyChoice" value="urgent-morning" /> urgent-morning</label>
            <label><input type="radio" name="urgencyChoice" value="urgent-afternoon" /> urgent-afternoon</label>
            <label><input type="radio" name="urgencyChoice" value="urgent-today" /> urgent-today</label>
            <label><input type="radio" name="urgencyChoice" value="urgent-soon" /> urgent-soon</label>
          </div>
        </div>

        <div class="group">
          <div class="label">Pressure</div>
          <div class="checks">
            <label><input type="radio" name="pressureChoice" value="high-pressure" /> high-pressure</label>
            <label><input type="radio" name="pressureChoice" value="low-pressure" /> low-pressure</label>
          </div>
        </div>

        <div class="group">
          <div class="label">Duration</div>
          <div class="checks">
            <label><input type="radio" name="durationChoice" value="estimated-under-5m" /> estimated-under-5m</label>
            <label><input type="radio" name="durationChoice" value="estimated-5m-to-15m" /> estimated-5m-to-15m</label>
            <label><input type="radio" name="durationChoice" value="estimated-15m-to-30m" /> estimated-15m-to-30m</label>
            <label><input type="radio" name="durationChoice" value="estimated-30m-to-1h" /> estimated-30m-to-1h</label>
            <label><input type="radio" name="durationChoice" value="estimated-1h-to-2h" /> estimated-1h-to-2h</label>
            <label><input type="radio" name="durationChoice" value="estimated-over-2h" /> estimated-over-2h</label>
          </div>
        </div>

        <div class="row" id="actionRow">
          <button id="submitUpdate">Update</button>
          <button id="focusStartBtn" class="icon-btn" title="Start focus">ðŸŽ¯ Focus</button>
          <button id="toggleVoice" class="icon-btn" title="Voice control">ðŸŽ¤ Start voice</button>
          <button id="prevTask" class="secondary">Previous</button>
          <button id="skipTask" class="secondary">Skip</button>
          <button id="doneTask" class="success sm">Done</button>
          <button id="deleteTask" class="danger sm">Delete</button>
          <div id="taskCounter" class="chip"></div>
        </div>
        <div id="status" class="status"></div>
      </section>

      <!-- Screen 5: Focus mode -->
      <section id="screen-focus" class="screen hidden">
        <div class="task-card">
          <div class="task-title" id="focusTaskTitle"></div>
          <div class="row" style="justify-content:space-between; align-items:center; gap:12px;">
            <div id="focusTimer" class="focus-timer" style="font-size:40px; font-weight:900; margin:8px 0; letter-spacing:1px;">00:00</div>
            <div class="row" style="margin:0; gap:8px; flex:1; justify-content:center;">
              <label for="focusMinutesInput" class="muted" style="margin-right:8px;">Minutes focused:</label>
              <input id="focusMinutesInput" type="number" min="0" step="1" placeholder="0" style="width:90px;" />
            </div>
            <div class="row" style="margin:0; gap:8px;">
              <button id="focusPause" class="secondary">Pause</button>
              <button id="focusStop" class="danger">Stop focus</button>
            </div>
          </div>
          <div id="focusStatus" class="status"></div>
          <div id="focusSubtasks" class="subtasks" style="display:none;"></div>
          <div id="focusInsights" class="insights">
            <div class="insights-grid">
              <div id="summaryCol">
                <div class="chart-card">
                  <div class="chart-title">Project summary</div>
                  <div id="projSummaryTable"></div>
                </div>
              </div>
              <div id="chartsCol">
                <div class="charts-row">
                  <div class="chart-card">
                    <div class="chart-title">Total tasks â€” last 30 days</div>
                    <canvas id="chartTotal30" width="600" height="120"></canvas>
                  </div>
                  <div class="chart-card">
                    <div class="chart-title">Total tasks â€” last 7 days</div>
                    <canvas id="chartTotal7" width="600" height="120"></canvas>
                  </div>
                </div>
                <div class="charts-row">
                  <div class="chart-card">
                    <div class="chart-title">Projectwise â€” last 30 days</div>
                    <canvas id="chartProj30" width="600" height="140"></canvas>
                  </div>
                  <div class="chart-card">
                    <div class="chart-title">Projectwise â€” last 7 days</div>
                    <canvas id="chartProj7" width="600" height="140"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div id="chartTooltip" class="chart-tooltip" style="display:none"></div>
          </div>
        </div>
      </section>

      <!-- Screen 3: All done -->
      <section id="screen-done" class="screen hidden">
        <h1>We are ready for the day! âœ¨</h1>
        <p class="muted">You've reviewed all tasks planned for today. Go get those wins. ðŸ’ª</p>
        <button id="restart" class="secondary">Start over</button>
      </section>

      <!-- Screen 4: Search results -->
      <section id="screen-search" class="screen hidden">
        <h1 id="searchHeader">Search results</h1>
        <div id="searchList" class="list"></div>
        <div class="row">
          <button id="backHome" class="secondary">Back</button>
        </div>
      </section>
    </div>

    <script src="popup.js" type="module"></script>
    <!-- Updating overlay -->
    <div id="overlay" class="overlay hidden">
      <div id="overlayContent" class="overlay-content">Updating taskâ€¦</div>
    </div>
  </body>
</html>